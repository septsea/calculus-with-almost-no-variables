\chapter{不定积分}

上一章, 我们接触了导数; 这一章, 我们来考虑导数的 ``反操作''.

具体地, 设 $I$ 为区间, 且 $f$ 是 $I$ 上的函数. 上一章的要点是: 已知 $f$, 求 $\mathrm{D}f$; 这一章的要点是: 已知 $I$ 上的函数 $g$ 适合 $\mathrm{D}f = g$, 求 $f$.

\section{原函数与不定积分}

设 $I$ 为区间. 不难看出, $I$ 上的常函数的导数是 $0$ (在 $I$ 上的限制). 不过, 重要地, 此事反过来也对:

\begin{theorem}
    设 $I$ 为区间. 设 $f$ 为 $I$ 上的可导函数. 若 $\mathrm{D}f = 0$, 则 $f$ 为常函数.
\end{theorem}

此事的论证可见于一般的分析教材, 所以我就不证了 (或许, 当我变强的时候, 我就能\emph{在我的书里}给出\emph{我自己的论证}了).

此事的一个重要的转述如下:

\begin{theorem}
    设 $I$ 为区间. 设 $f_1$, $f_2$ 为 $I$ 上的可导函数. 若 $\mathrm{D}{f_1} = \mathrm{D}{f_2}$, 则存在常函数 $c$, 使 $f_2 = f_1 + c$.
\end{theorem}

\begin{proof}
    考虑 $h = f_2 - f_1$. 那么 $\mathrm{D}h = 0$. 从而 $h$ 是常函数.
\end{proof}

由此, 我们作如下定义.

\begin{definition}
    设 $I$ 为区间. 设 $f$ 为 $I$ 上的函数. 若存在 $I$ 上的可导函数 $F$ 使 $\mathrm{D}F = f$, 则说 $F$ 是 $f$ 的一个\emph{原函数}.
\end{definition}

\begin{definition}
    设 $I$ 为区间. 设 $f$ 为 $I$ 上的函数. 设 $f$ 有一个原函数. 那么, 称 $f$ 的\emph{全体}原函数作成的\emph{集}为 $f$ 的\emph{不定积分}, 即
    \begin{align*}
        \int {f} = \{ g \mid \text{$g$ 是 $f$ 的原函数} \}.
    \end{align*}
\end{definition}

\begin{theorem}
    设 $I$ 为区间. 设 $f$ 为 $I$ 上的函数. 设 $F$ 是 $f$ 的原函数. 则
    \begin{align*}
        \int {f} = \{ F + c \mid \text{$c$ 是 $I$ 上的常函数} \}.
    \end{align*}
\end{theorem}

\begin{proof}
    设 $G$ 是 $f$ 的一个原函数. 则 $G = F + c$, 其中 $c$ 为某个常函数. 故
    \begin{align*}
        \int {f} \subset \{ F + c \mid \text{$c$ 是 $I$ 上的常函数} \}.
    \end{align*}
    另一方面, 若 $c^{\prime}$ 是常函数, 显然有 $\mathrm{D}[F + c^{\prime}] = \mathrm{D}F = f$. 所以
    \begin{align*}
         & {\int {f} \supset \{ F + c \mid \text{$c$ 是 $I$ 上的常函数} \}}. \qedhere
    \end{align*}
\end{proof}

\begin{example}
    因为 $\mathrm{D}\, \mathrm{exp} = \mathrm{exp}$, 故
    \begin{align*}
        \int {\mathrm{exp}} = \{ \mathrm{exp} + c \mid \text{$c$ 是 $\mathbb{R}$ 上的常函数} \}.
    \end{align*}
\end{example}

\begin{example}
    因为 $\mathrm{D}\, [-\mathrm{cos}] = \mathrm{sin}$, 故
    \begin{align*}
        \int {\mathrm{sin}} = \{ -\mathrm{cos} + c \mid \text{$c$ 是 $\mathbb{R}$ 上的常函数} \}.
    \end{align*}
\end{example}

\begin{example}
    因为 $\mathrm{D}\, \mathrm{sin} = \mathrm{cos}$, 故
    \begin{align*}
        \int {\mathrm{cos}} = \{ \mathrm{sin} + c \mid \text{$c$ 是 $\mathbb{R}$ 上的常函数} \}.
    \end{align*}
\end{example}

至此, 我们已经知道什么是不定积分. 不过, 我们也可以看到, 当前的表达不定积分的方式比较复杂. 所以, 我们很需要一种简写法; 我们将在下一节讨论此事.

我们知道, 若区间 $I$ 上的函数有原函数, 那自然地有不定积分. 什么样的函数有原函数呢? 下面的结论给出了此问题的\emph{部分}解答; 不过, 就算只是 ``部分'', 对本书而言, 也足够了.

\begin{theorem}
    设 $I$ 为区间. 设 $f$ 是 $I$ 上的连续函数. 则存在 $I$ 上的可导函数 $F$, 使 $\mathrm{D}F = f$.
\end{theorem}

\begin{proof}
    固定 $a \in I$. 作函数
    \begin{align*}
        \text{$F$:} \quad
        I & \to \mathbb{R},           \\
        t & \mapsto \int_{a}^{t} {f}.
    \end{align*}
    任取 $x \in I$. 从而对任意 $t \in I$,
    \begin{align*}
        F[t] = \int_{a}^{x} {f} + \int_{x}^{t} {f} = F[x] + (t - x) Q [t],
    \end{align*}
    其中
    \begin{align*}
        \text{$Q$:} \quad
        I & \to \mathbb{R},                                                       \\
        t & \mapsto \begin{cases}
                        f[x],                                             & t = x;    \\
                        {\displaystyle \frac{1}{t - x} \int_{x}^{t} {f}}, & t \neq x.
                    \end{cases}
    \end{align*}
    取 $x$ 的一个邻域 $N$. 所以, 在 $N \cap I$ 上, 有
    \begin{align*}
        F = F[x] + (\iota - x) Q,
    \end{align*}
    且 $Q$ 于 $x$ 连续 (定理~\ref{theorem:newton-leibniz-prerequisite}), 故 $F$ 于 $x$ 可导, 且 $F$ 于 $x$ 的导数为
    \begin{align*}
         & Q [x] = f[x]. \qedhere
    \end{align*}
\end{proof}

由此可得微积分的一个重要定理. 不过, 这不是本章的重点讨论对象.

\begin{restatable}[Newton-Leibniz]{theorem}{NewtonLeibniz} \label{theorem:NewtonLeibniz}
    设 $I$ 为区间. 设 $f$ 是 $I$ 上的连续函数. 设 $F$ 是 $f$ 的原函数. 则对任意 $a$, $b \in I$,
    \begin{align*}
        \int_{a}^{b} {f} = F[b] - F[a].
    \end{align*}
\end{restatable}

\begin{proof}
    固定 $c \in I$. 作函数
    \begin{align*}
        \text{$G$:} \quad
        I & \to \mathbb{R},           \\
        t & \mapsto \int_{c}^{t} {f}.
    \end{align*}
    那么 $G$ 是 $f$ 的原函数, 且
    \begin{align*}
        \int_{a}^{b} {f}
        = \int_{a}^{c} {f} + \int_{c}^{b} {f}
        = -\int_{c}^{a} {f} + \int_{c}^{b} {f}
        = G[b] - G[a].
    \end{align*}
    既然 $F$ 也是 $f$ 的原函数, 那必定存在常函数 $\ell$, 使 $G = F + \ell$. 所以
    \begin{align*}
        \int_{a}^{b} {f}
        = {} & G[b] - G[a]                         \\
        = {} & (F + \ell)[b] - (F + \ell)[a]       \\
        = {} & (F[b] + \ell[b]) - (F[a] + \ell[a]) \\
        = {} & (F[b] + \ell) - (F[a] + \ell)       \\
        = {} & F[b] - F[a]. \qedhere
    \end{align*}
\end{proof}

\section{函数集的演算}

上节, 我们正式地定义了区间 $I$ 上的函数 $f$ 的不定积分是 $f$ 的全体原函数作成的集. 随后, 我们知道, 若 $\mathrm{D}F = f$, 则
\begin{align*}
    \int {f} = \{ F + c \mid \text{$c$ 是 $I$ 上的常函数} \}.
\end{align*}
不过, 此表达似乎不是很简洁. 很少有人愿意每次写不定积分都要写上形如 ``$c$ 是 $I$ 上的常函数'' 这样的话. 并且, 这种表达方式也不利于我们表达不定积分跟不定积分的关系.

\begin{example}
    设 $f$, $g$ 都是区间 $I$ 上的函数, 且不定积分存在. 我们看 $f + g$ 是否有不定积分. 为回答这个问题, 无妨设 $F$, $G$ 分别是 $f$, $g$ 的原函数. 那么 $\mathrm{D}[F + G] = f + g$. 从而, $f + g$ 确实有不定积分
    \begin{align*}
        A = \int {(f + g)} = \{ F + G + c \mid \text{$c$ 是 $I$ 上的常函数} \}.
    \end{align*}
    记
    \begin{align*}
        B = \Bigg\{ u + v \,\,\Bigg|\,\, \text{$u \in \int {f}$, 且 $v \in \int {g}$} \Bigg\}.
    \end{align*}
    我们证明: $A = B$.

    任取 $F + G + c \in A$. 那么 $F \in \int {f}$, 且 $G + c \in \int {g}$. 所以 $F + G + c \in B$. 这说明, $A \subset B$.

    任取 $u + v \in B$, 其中 $u \in \int {f}$, 且 $v \in \int {g}$. 那么存在常函数 $d_1$, $d_2$ 使 $u = F + d_1$, $v = G + d_2$. 所以 $u + v = F + G + (d_1 + d_2)$. 二个常函数的和仍为常函数, 故 $u + v \in A$. 这说明, $A \supset B$.

    我们该怎样描述 $\int {(f + g)}$, $\int {f}$ 与 $\int {g}$ 的关系? 您可能在其他的分析教材里见过形如
    \begin{align*}
        \int {(f + g)} = \int {f} + \int {g}
    \end{align*}
    的文字. 不过, 上式右端的 ``$+$'' 是什么意思? 或者, 具体地, 焊接二个集的 $+$ 是什么意思呢?
\end{example}

上例告诉我们, 我们很需要为函数集定义新的运算; 更确切地, 我们很需要搬函数的运算到函数集上.

\begin{definition}
    设 $A$ 为集. 若任取 $A$ 的元 $f$, $f$ 是一个函数, 就称 $A$ 为\emph{函数集}.

    设 $P$, $Q$ 为二个集. 若函数集 $A$ 的每个元都是 $P$ 上的函数, 就说 $A$ 是 $P$ 上的函数集. 若函数集 $A$ 的每个元都是 $P$ 到 $Q$ 的函数 (定义域为 $P$, 陪域为 $Q$), 则说 $A$ 是 $P$ 到 $Q$ 的函数集. 此时, 我们也说, 函数集 $A$ 的定义域为 $P$, 陪域为 $Q$.
\end{definition}

\begin{definition}
    设 $A$ 是 $P$ 到 $Q$ 的函数集, $B$ 是 $R$ 到 $S$ 的函数集, 且任取 $A$ 的元 $a$, $a$ 的值域是 $R$ 的子集. 于是, 任取 $B$ 的元 $b$, $b \circ a$: $P \to S$ 有意义. 定义
    \begin{align*}
        B \circ A = \{ b \circ a \mid \text{$b \in B$, $a \in A$} \}.
    \end{align*}
    不难看出, $B \circ A$ 就是 $P$ 到 $S$ 的函数集.
\end{definition}

函数集的复合也有结合律.

\begin{theorem}
    设 $A$ 是 $P$ 到 $Q$ 的函数集, $B$ 是 $R$ 到 $S$ 的函数集, $C$ 是 $T$ 到 $U$ 的函数集. 设任取 $A$ 的元 $a$, $a$ 的值域是 $R$ 的子集; 设任取 $B$ 的元 $b$, $b$ 的值域是 $S$ 的子集. 则
    \begin{align*}
        C \circ (B \circ A) = (C \circ B) \circ A.
    \end{align*}
    所以, 我们可简单地记上式的任意一侧为 $C \circ B \circ A$.
\end{theorem}

此事的论证不难; 不过, 我希望您能适应这种论证方式; 这样, 您就完全可类似地论证其他的关于函数集的运算律.

\begin{proof}
    取 $f \in C \circ (B \circ A)$. 于是, 存在 $a \in A$, $b \in B$, $c \in C$ 使 $f = c \circ (b \circ a)$. 因为函数的复合适合结合律, 故
    \begin{align*}
         & f = c \circ (b \circ a) = (c \circ b) \circ a \in (C \circ B) \circ A.
    \end{align*}
    再取 $g \in (C \circ B) \circ A$. 于是, 存在 $a^{\prime} \in A$, $b^{\prime} \in B$, $c^{\prime} \in C$ 使 $g = (c^{\prime} \circ b^{\prime}) \circ a^{\prime}$. 因为函数的复合适合结合律, 故
    \begin{align*}
         & g = (c^{\prime} \circ b^{\prime}) \circ a^{\prime} = c^{\prime} \circ (b^{\prime} \circ a^{\prime}) \in C \circ (B \circ A). \qedhere
    \end{align*}
\end{proof}

就像为函数集引入复合那样, 对 $\mathbb{R}$ 的子集到 $\mathbb{R}$ 的子集的函数集, 我们还可引入 $+$, $-$, $\cdot$, $/$, $\text{\textasciicircum}$ 等运算.

\begin{definition}
    设 $P$, $Q$, $S$ 是 $\mathbb{R}$ 的子集. 设 $A$ 是 $P$ 到 $Q$ 的函数集, $B$ 是 $P$ 到 $S$ 的函数集. 设 $\ast$ 为三文字 $+$, $-$, $\cdot$ 的任意一个. 定义
    \begin{align*}
        A \ast B = \{ a \ast b \mid \text{$a \in A$, $b \in B$} \},
    \end{align*}
    其中 $A \ast B$ 的陪域可按需要决定. 一般地, 我们可写 $\{ 0 \} - B$ 为 $-B$, 写 $A \cdot B$ 为 $AB$.

    若任取函数集 $A$ 的元 $a$, 任取 $p \in P$, 都有 $a[p] \neq 0$, 则定义
    \begin{align*}
        \frac{B}{A} = \Bigg\{ \frac{b}{a} \,\Bigg|\,  \text{$b \in B$, $a \in A$} \Bigg\},
    \end{align*}
    其中陪域可按需要决定.

    若对任意 $a \in A$, $b \in B$, $p \in P$, ${a[p]}^{b[p]}$ 有意义, 则还可定义
    \begin{align*}
        A^B = \{ a^b \mid \text{$a \in A$, $b \in B$} \},
    \end{align*}
    其中陪域可按需要决定.
\end{definition}

现在, 我邀请您证明函数集的如下性质. 我就不证明了; 因为我想, 我已经告诉您怎么论证了.

\begin{theorem}
    设 $P$ 是 $\mathbb{R}$ 的子集. 设 $A$, $B$, $C$ 都是 $P$ 到 (某个) $\mathbb{R}$ 的子集的函数集. 则
    \begin{align*}
        \begin{array}{ll}
            A + B = B + A,             & AB = BA,            \\
            (A + B) + C = A + (B + C), & (AB)C = A(BC).
        \end{array}
    \end{align*}
\end{theorem}

\begin{theorem}
    设 $P$ 是 $\mathbb{R}$ 的子集. 任取函数集 $L$ 的元 $\ell$, $\ell$ 的值域都是 $P$ 的子集. 设 $A$, $B$ 是 $P$ 上的函数集. 设 $\ast$ 是五文字 $+$, $-$, $\cdot$, $/$, $\text{\textasciicircum}$ 的任意一个. 则
    \begin{align*}
        (A \ast B) \circ L = (A \circ L) \ast (B \circ L).
    \end{align*}
\end{theorem}

尽管函数集跟函数有类似的运算律, 不过, 这并不是说, 函数的每一个运算律都可被搬到函数集上.

\begin{example}
    设 $P \subset \mathbb{R}$. 设 $0$ 是 $P$ 上的恒取零值的函数. 那么, 不难看出, 对任意 $p \in P$:
    \begin{itemize}
        \item $p + 0 = p$;
        \item 存在 $q \in P$, 使 $p + q = 0$ (取 $q$ 为 $-p$ 即可).
    \end{itemize}
    由此, 我们不难推出: 若 $p$, $q$, $r \in P$, 且 $q + p = r + p$, 则 $q = r$; 在等式二侧同时加 $-p$, 利用结合律, 再利用 $0$ 的性质即知. 我们姑且称这个性质为函数的加法的消去律.

    函数集的加法也有消去律吗? 一般来说, 没有. 取 $A = \{ 1 \}$; 取 $B$, $C$ 为
    \begin{align*}
        \{ 0, 1, -1, 2, -2, 3, -3, 4, -4, \dots \},
    \end{align*}
    这里的 $0$, $1$, $-1$, $\dots$ 都是 $P$ 上的常函数. 那么, 不难验证, $A + C = B + C = C$. 可是, $A \neq B$.
\end{example}

现在我们考虑一类特殊的函数集; 这也是不定积分的演算重点考察的对象.

我们先为一种特殊的函数集引入方便的记号.

设 $P \subset \mathbb{R}$. 考虑 $P$ 上的函数. 任取实数 $c$, 我们总可以作一个 $P$ 上的常函数
\begin{align*}
    \text{$c$:} \quad
    P & \to \{ c \}, \\
    t & \mapsto c.
\end{align*}
反过来, 任取 $P$ 上的一个 (实的) 常函数 $f$, 我们也总能找到一个实数 $c$, 使任取 $t \in P$, 都有 $f[t] = c$. 并且, 不同的实数 (常函数) 对应着不同的常函数 (实数). 我们记全体实数作成的集为 $\mathbb{R}$; 所以, 我们也无妨记全体 $P$ 上的 (实的) 常函数作成的集为 $\mathbb{R}_{P}$. 我们曾说, 除非有必要, 我们不严格区分函数及其限制; 也就是说, 在语境明确的时候, 我们也可写 $\mathbb{R}_{P}$ 为 $\mathbb{R}$.

下面的几条性质十分重要.

\begin{theorem}
    设 $\mathbb{R}_{P}$ 为 $P$ 上的全体常函数作成的集. 则 $\mathbb{R}_{P} + \mathbb{R}_{P} = \mathbb{R}_{P}$.
\end{theorem}

\begin{proof}
    任取 $f \in \mathbb{R}_{P} + \mathbb{R}_{P}$. 那么, 存在 $f_1$, $f_2 \in \mathbb{R}_{P}$, 使 $f = f_1 + f_2$. 因为二个常函数的和还是常函数, 故 $f \in \mathbb{R}_{P}$. 反过来, 任取 $g \in \mathbb{R}_{P}$. 因为 $g = g + 0$, 且 $0 \in \mathbb{R}_{P}$, 故 $g \in \mathbb{R}_{P} + \mathbb{R}_{P}$.
\end{proof}

\begin{theorem}
    设 $\mathbb{R}_{P}$ 为 $P$ 上的全体常函数作成的集.
    \begin{itemize}
        \item 若 $d \in \mathbb{R}_{P}$, 则 $\{ d \} + \mathbb{R}_{P} = \mathbb{R}_{P}$.
        \item 若 $k \in \mathbb{R}_{P}$, 且 $k \neq 0$, 则 $\{ k \} \cdot \mathbb{R}_{P} = \mathbb{R}_{P}$.
    \end{itemize}
\end{theorem}

\begin{proof}
    我在此处论证关于加的等式. 任取 $f \in \{ d \} + \mathbb{R}_{P}$. 那么, 存在 $e \in \mathbb{R}_{P}$ 使 $f = d + e$. 因为二个常函数的和还是常函数, 故 $f \in \mathbb{R}_{P}$. 反过来, 任取 $g \in \mathbb{R}_{P}$. 因为 $g = d + (g - d)$, 且 $g - d \in \mathbb{R}_{P}$, 故 $g \in \{ d \} + \mathbb{R}_{P}$.

    论证关于乘的等式的方法是类似的. 不过, 要注意一些细节. $k \neq 0$ 的意思是 $k$ 跟 $0$ 作为\emph{函数}不相等; 所以, 是\emph{存在} $p \in P$, 使 $k[p] \neq 0[p]$. 不过, 因为 $k$ 跟 $0$ 都是\emph{常函数}, 故 $k \neq 0$ (实数的不相等). 所以 $k$ 有倒数 $k^{-1}$, 且 $k^{-1}$ 也是常函数.
\end{proof}

\begin{theorem}
    设 $\mathbb{R}_{P}$ 为 $P$ 上的全体常函数作成的集. 设函数集 $A$ 的每一个函数的值域都是 $P$ 的子集. 则 $\mathbb{R}_{P} \circ A = \mathbb{R}_{P}$.
\end{theorem}

\begin{proof}
    注意到对任意 $a \in A$, $k \in \mathbb{R}_{P}$, 必有 $k \circ a = k$.
\end{proof}

设 $I$ 是区间. 设 $f$ 是 $I$ 上的函数. 设 $F$ 是 $f$ 的一个原函数. 那么, 我们就可以简单地写
\begin{align*}
    \int {f} = \{ F \} + \mathbb{R}.
\end{align*}
您可能会觉得写 $\{ F \}$ 较繁. 所以, 我们再简化一下记号.

\begin{example}
    我假定您学过高中算学里的立体几何.

    在高中, 您一开始就学了集与集的关系、运算. 自然地, 我们视平面为\emph{点集} (每一个元都是点的集), 也视直线为\emph{点集}. 那么, 点 $P$ 在直线 $\ell$ 上, 就是 $P \in \ell$; 点 $P$ 不在直线 $\ell$ 上, 就是 $P \notin \ell$. 类似地, 点 $P$ 在平面 $\Pi$ 内, 就是 $P \in \Pi$; 点 $P$ 不在平面 $\Pi$ 内, 就是 $P \notin \Pi$.

    现在, 我们任取一个平面 $\Pi$ 与一条直线 $\ell$. 您也知道, 下面的三事, 有且只有一件能发生:
    \begin{itemize}
        \item $\ell$ 上的每一个点都是 $\Pi$ 的点. 我们可简单地记此事为 $\ell \subset \Pi$.
        \item $\ell$ 上的每一个点都不是 $\Pi$ 的点. 我们说, $\ell \cap \Pi$ 是空集.
        \item 存在唯一的一点 $P$, 使 $P \in \ell$, 且 $P \in \Pi$. 高中算学会这么写: $\ell \cap \Pi = P$.
    \end{itemize}
    Well. 正如您所见, 按道理, 我们应当写 $\ell \cap \Pi = \{ P \}$; 毕竟, 我们说, 平面跟直线都是\emph{点集}. 可是, 我们省略了 $\{ \, \}$. 也就是说, 我们简单地写刚好有一个元的集 $\{ a \}$ 为 $a$. 不重要地, 高中算学一开始讲集时, 用 $A \subseteq B$ 表达 ``$A$ 是 $B$ 的子集'', 用 $A \subsetneqq B$ 表达 ``$A$ 是 $B$ 的真子集''; where are you, $\subset$?

    当然了, 也不是每个高中算学老师都是 ``盲人''. 假如您对此事感兴趣, 您可以参考阮龙培的《关于立体几何应用集合论符号的几点看法》与吴长庆的《立体几何使用 ``集合语言'' 的准确性》. 我承认, 这些文章都比我老.
\end{example}

借此机会, 我说一说我的观点吧. 我的有限的语言知识告诉我, 土话跟胡话都有不少多义词. 这里, ``多义'' 并不是指有 ``很大的区别'' 的解释, 而是说这些含义 ``相似'', 但又不完全一样 (我加了引号, 因为我不知道怎么用行话表达我的想法). 就拿 ``曲线'' (胡话: curve) 为例吧. 在中学, 我们一般视曲线为点集. 所以, 我们说, (平面的) 曲线有隐方程 $F[x, y] = 0$, 也有参数方程 $x = f[t]$, $y = g[t]$, $t \in A$ ($A$ 就是所谓的 ``参数区间''). 这么看来, 曲线就是全体适合隐方程 (或参数方程) 的 $(x, y)$ 作成的集. 在算学分析 (或高等算学) 里, 您可能也学过怎么用积分算曲线的长. 这个时候, 曲线的方程可能更重要; 这是因为, 曲线的 ``几何性质'' 似乎对曲线的长的公式的推导没有帮助. 我们计算曲线的长时, 一般都要求 ``曲线的参数方程'' 的导数连续——这其实涉及到方程的分析性质了. (假如您对此事感兴趣, 您可以参考美国算学家 Walter Rudin 的教材 \textit{Principles of Mathematical Analysis, 3rd ed}.)

目前, 算学家都是人; 不过, 人类, 似乎生来就想着偷懒. 所以说, 算学家也不例外. 算学家一方面追求严谨; 另一方面, 假如记号不是很简洁, 算学家自己写起来都费劲. 所以, 算学家会说: ``在本书 (或本文、本节、本章), 为方便, 我们约定文字 (表达式、符号) $\times \times \times$ 表示……'' 不过, 我觉得, 可以先给出 ``稍繁琐的写法'', 再给 ``简单的写法''; 这或许能让学生体会到简单的写法为什么方便. 可惜, 我看了好几本新的高中算学书, 都是一开始用 $\subseteq$ 表子集, 而在立体几何里 ``借用'' $\subset$ 表直线的每一点都在平面内; 没有一本 (高中算学) 教材说 ``为方便, 我们用 $\subset$ 表子集, 并省去刚好有一个元的集 $\{ a \}$ 外的花括号''.

好了, 我就说这么多吧. 严格地, 这算是 ``私货'' 了; 可是, 这是一本告诉他人我 (与一些算学家) 的想法的微积分读物. 假如我不带 ``私货'', 那我要带什么呢? 或许, 我不如不写这本书.

现在, 请允许我正式地作出这样的约定: 在不引起混淆时, 我们可写恰含一个元的集 $\{ a \}$ 为 $a$. 所以, 像 $a \in a$, $a \subset \{ a \}$ 的表达都是可被接受的.

设 $I$ 是区间. 设 $f$ 是 $I$ 上的函数. 设 $F$ 是 $f$ 的一个原函数. 那么, 我们就可以简单地写
\begin{align*}
    \int {f} = F + \mathbb{R}.
\end{align*}
代 $f$ 以 $\mathrm{D}F$, 就有
\begin{align*}
    \int {\mathrm{D}F} = F + \mathbb{R}.
\end{align*}
不严格地, 若忽视常函数, 那么不定积分 ``抵消了'' 导数. 反过来呢?

\begin{definition}
    设 $I$ 是区间. 设 $A$ 是 $I$ 上的函数集, 且 $A$ 的每个元都是可导函数. 我们说, $A$ 是 $I$ 上的\emph{可导函数集}. 定义
    \begin{align*}
        \mathrm{D} [A] = \{ \mathrm{D}a \mid a \in A \}.
    \end{align*}
    有时, 我们也可简单地写 $\mathrm{D}[A]$ 为 $\mathrm{D}A$.
\end{definition}

\begin{example}
    不难看出, $\mathrm{D} \mathbb{R} = \{ 0 \} = 0$.
\end{example}

设 $I$ 是区间. 设 $f$ 是 $I$ 上的函数. 设 $F$ 是 $f$ 的一个原函数. 那么
\begin{align*}
    \mathrm{D} \Bigg[ \int {f} \Bigg]
    = {} & \mathrm{D} [\{ F + c \mid \text{$c \in \mathbb{R}$} \}] \\
    = {} & \{ \mathrm{D}[F + c] \mid \text{$c \in \mathbb{R}$} \}  \\
    = {} & \{ f \mid \text{$c \in \mathbb{R}$} \}                  \\
    = {} & \{ f \}  = f.
\end{align*}
所以, 不严格地, 我们也可以说, 导数 ``抵消了'' 不定积分.

\begin{definition}
    设 $P \subset \mathbb{R}$. 设 $A$ 为 $P$ 上的函数集. 若存在 $a \in A$ 使 $P = \{ a \} + \mathbb{R} = a + \mathbb{R}$, 就说 $A$ 是 $P$ 上的\emph{至多相差常函数的函数集}.
\end{definition}

\begin{remark}
    或许这样的函数集有更好的名字; 不过, 我姑且这么叫吧.
\end{remark}

\begin{theorem}
    设 $P \subset \mathbb{R}$. 设 $f$ 是 $P$ 上的函数.
    \begin{itemize}
        \item 若 $g$ 是 $P$ 上的函数, 则
              \begin{align*}
                  (f + \mathbb{R}) + (g + \mathbb{R}) = (f + g) + \mathbb{R}.
              \end{align*}
        \item 若 $g$ 是 $P$ 上的函数, 则
              \begin{align*}
                  f + (g + \mathbb{R}) = (f + g) + \mathbb{R}.
              \end{align*}
              特别地, 取 $g$ 为常函数 $c$, 则
              \begin{align*}
                  f + \mathbb{R} = f + (c + \mathbb{R}) = (f + c) + \mathbb{R}.
              \end{align*}
        \item 若 $k \in \mathbb{R}$, 且 $k \neq 0$, 则
              \begin{align*}
                  k(f + \mathbb{R}) = kf + \mathbb{R}.
              \end{align*}
        \item 若函数 $h$ 的值域是 $P$ 的子集, 则
              \begin{align*}
                  (f + \mathbb{R}) \circ h = f \circ h + \mathbb{R}.
              \end{align*}
    \end{itemize}
\end{theorem}

\begin{proof}
    利用函数集的运算律与 $\mathbb{R}$ 的性质, 有
    \begin{align*}
        (f + \mathbb{R}) + (g + \mathbb{R})
        = {} & (\{ f \} + \mathbb{R}) + (\{ g \} + \mathbb{R}) \\
        = {} & ((\{ f \} + \mathbb{R}) + \{ g \}) + \mathbb{R} \\
        = {} & (\{ f \} + (\mathbb{R} + \{ g \})) + \mathbb{R} \\
        = {} & (\{ f \} + (\{ g \} + \mathbb{R})) + \mathbb{R} \\
        = {} & ((\{ f \} + \{ g \}) + \mathbb{R}) + \mathbb{R} \\
        = {} & (\{ f + g \} + \mathbb{R}) + \mathbb{R}         \\
        = {} & \{ f + g \} + (\mathbb{R} + \mathbb{R})         \\
        = {} & (f + g) + \mathbb{R}.
    \end{align*}
    类似地,
    \begin{align*}
        f + (g + \mathbb{R})
        = {} & \{ f \} + (\{ g \} + \mathbb{R}) \\
        = {} & (\{ f \} + \{ g \}) + \mathbb{R} \\
        = {} & (f + g) + \mathbb{R}.
    \end{align*}

    取 $f_1 \in k(f + \mathbb{R})$. 那么, 存在 $c \in \mathbb{R}$ 使 $f_1 = k(f + c) = kf + kc \in kf + \mathbb{R}$. 取 $f_2 \in kf + \mathbb{R}$. 那么, 存在 $d \in \mathbb{R}$ 使 $f_2 = kf + d$. 因为 $k \neq 0$, 故 $f_2 = kf + kk^{-1}d = k(f + k^{-1}d) \in k(f + \mathbb{R})$.

    最后一个也不难:
    \begin{align*}
        (f + \mathbb{R}) \circ h
        = {} & (\{ f \} + \mathbb{R}) \circ \{ h \}             \\
        = {} & \{ f \} \circ \{ h \} + \mathbb{R} \circ \{ h \} \\
        = {} & ( f \circ h ) + \mathbb{R}. \qedhere
    \end{align*}
\end{proof}

\section{不定积分的演算}

现在, 我们研究怎么算不定积分.

\begin{theorem}
    设 $I$ 是区间. 设 $F$ 是 $I$ 上的可导函数. 则
    \begin{align*}
        \int {\mathrm{D}F} = F + \mathbb{R}.
    \end{align*}
\end{theorem}

\begin{proof}
    我已经证过它了.
\end{proof}

这或许是最基本的计算法了. 一般来说, ``简单的'' 函数的不定积分都可以这么求出来.

\begin{example}
    设 $I$ 是某个不含 $0$ 的区间. 求 $\int {\iota^{-1}}$.

    我们知道, $\mathrm{D}[\mathrm{ln} \circ \mathrm{abs}] = \iota^{-1}$. 所以
    \begin{align*}
        \int {\iota^{-1}} = \mathrm{ln} \circ \mathrm{abs} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{theorem}
    设 $I$ 是区间. 设 $f$, $g$ 是 $I$ 上的函数. 设 $f$, $g$ 都有不定积分.
    \begin{itemize}
        \item $f + g$ 也有不定积分, 且
              \begin{align*}
                  \int {(f + g)} = \int {f} + \int {g}.
              \end{align*}
        \item 设 $k \in \mathbb{R}$, 且 $k \neq 0$. 则 $kf$ 也有不定积分, 且
              \begin{align*}
                  \int {kf} = k \int{f}.
              \end{align*}
    \end{itemize}
\end{theorem}

\begin{proof}
    设 $F$, $G$ 分别是 $f$, $g$ 的原函数. 那么
    \begin{align*}
        \int {f} = F + \mathbb{R}, \quad \int {g} = G + \mathbb{R}.
    \end{align*}
    因为 $\mathrm{D}[F + G] = f + g$, 故
    \begin{align*}
        \int {(f + g)}
        = {} & (F + G) + \mathbb{R}                \\
        = {} & (F + \mathbb{R}) + (G + \mathbb{R}) \\
        = {} & \int {f} + \int {g}.
    \end{align*}
    类似地, 因为 $\mathrm{D}[kF] = kf$, 且 $k \neq 0$, 故
    \begin{align*}
         & {\int {kf}} = kF + \mathbb{R} = k(F + \mathbb{R}) = k\int {f}. \qedhere
    \end{align*}
\end{proof}

\begin{remark}
    注意到 $\int {0} = \mathbb{R}$. 所以, 对任意 $k \in \mathbb{R}$,
    \begin{align*}
        \int {kf} = k\int {f} + \mathbb{R}.
    \end{align*}
\end{remark}

\begin{example}
    设 $A$ 是 $P \subset \mathbb{R}$ 上的函数集. 那么, 不难验证, $-A = (-1)A$. 所以, 特别地, 有
    \begin{align*}
        \int {(f - g)}
        = {} & \int {(f + (-1)g)}      \\
        = {} & \int {f} + \int {(-1)g} \\
        = {} & \int {f} + (-1)\int {g} \\
        = {} & \int {f} - \int {g}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
         & \int {\mathrm{cos}} = \int {\mathrm{D}\,\mathrm{sin}} = \mathrm{sin} + \mathbb{R},                                               \\
         & \int {\mathrm{sin}} = \int {(-1)\mathrm{D}\,\mathrm{cos}} = (-1)\int {\mathrm{D}\,\mathrm{cos}} = -\mathrm{cos} + \mathbb{R},    \\
         & \int {\mathrm{exp}} = \int {\mathrm{D}\,\mathrm{exp}} = \mathrm{exp} + \mathbb{R},                                               \\
         & \int {\iota^n} = \int {\frac{1}{n+1} \mathrm{D}\,\iota^{n+1}} = \frac{\iota^{n+1}}{n+1} + \mathbb{R} \quad \text{($n \neq -1$)}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {(3\,\mathrm{cos} - 4\,\mathrm{sin} + 5\,\mathrm{exp})}
        = {} & \int {(3\,\mathrm{cos} - 4\,\mathrm{sin})} + \int {5\,\mathrm{exp}}                              \\
        = {} & \int {3\,\mathrm{cos}} - \int {4\,\mathrm{sin}} + \int {5\,\mathrm{exp}}                         \\
        = {} & 3\int {\mathrm{cos}} - 4\int {\mathrm{sin}} + 5\int {\mathrm{exp}}                               \\
        = {} & 3(\mathrm{sin} + \mathbb{R}) - 4(-\mathrm{cos} + \mathbb{R}) + 5(\mathrm{exp} + \mathbb{R})      \\
        = {} & (3\,\mathrm{sin} + \mathbb{R}) + (4\,\mathrm{cos} + \mathbb{R}) + (5\,\mathrm{exp} + \mathbb{R}) \\
        = {} & ((3\,\mathrm{sin} + 4\,\mathrm{cos}) + \mathbb{R}) + (5\,\mathrm{exp} + \mathbb{R})              \\
        = {} & 3\,\mathrm{sin} + 4\,\mathrm{cos} + 5\,\mathrm{exp} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
         & \int {\frac{1}{\mathrm{cos}^2}} = \int {(1 + \mathrm{tan}^2)} = \int {\mathrm{D}\,\mathrm{tan}} = \mathrm{tan} + \mathbb{R}, \\
         & \int {\frac{1}{1 + \iota^2}} = \int {\mathrm{D}\,\mathrm{arctan}} = \mathrm{arctan} + \mathbb{R},                            \\
         & \int {\frac{1}{\sqrt{1 - \iota^2}}} = \int {\mathrm{D}\,\mathrm{arcsin}} = \mathrm{arcsin} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {\mathrm{tan}^2}
        = {} & \int {(1 + \mathrm{tan}^2) - 1}                    \\
        = {} & \int {(1 + \mathrm{tan}^2)} - \int {1}             \\
        = {} & (\mathrm{tan} + \mathbb{R}) - (\iota + \mathbb{R}) \\
        = {} & \mathrm{tan} - \iota + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {\frac{\iota^4}{1 + \iota^2}}
        = {} & \int {\frac{\iota^4 - 1 + 1}{1 + \iota^2}}                                                           \\
        = {} & \int {\Bigg( \iota^2 - 1 + \frac{1}{1 + \iota^2} \Bigg)}                                             \\
        = {} & \int {\iota^2} - \int {1} + \int {\frac{1}{1 + \iota^2}}                                             \\
        = {} & \Bigg( \frac{\iota^3}{3} + \mathbb{R} \Bigg) - (\iota + \mathbb{R}) + (\mathrm{arctan} + \mathbb{R}) \\
        = {} & \frac{\iota^3}{3} - \iota + \mathrm{arctan} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{theorem}
    设 $I$, $J$ 为区间. 设 $g$ 是 $J$ 上的函数, 且有不定积分. 设 $f$: $I \to J$ 是可导函数. 则 $(g \circ f)\, \mathrm{D}f$ 也有不定积分, 且
    \begin{align*}
        \int {(g \circ f)\, \mathrm{D}f} = \Bigg( \int {g} \Bigg) \circ f.
    \end{align*}
\end{theorem}

\begin{proof}
    设 $G$ 是 $g$ 的原函数. 则
    \begin{align*}
        \mathrm{D}[G \circ f] = (\mathrm{D}G \circ f)\, \mathrm{D}f = (g \circ f)\, \mathrm{D}f.
    \end{align*}
    从而
    \begin{align*}
        \int {(g \circ f)\, \mathrm{D}f}
        = {} & G \circ f + \mathbb{R}                   \\
        = {} & (G + \mathbb{R}) \circ f                 \\
        = {} & \Bigg( \int {g} \Bigg) \circ f. \qedhere
    \end{align*}
\end{proof}

\begin{remark}
    作为对比, 我们看看怎么用传统的记号表示此事.

    设 $I$, $J$ 为区间. 设 $g$ 是 $J$ 上的函数, 且有不定积分
    \begin{align*}
        \int {g(x)\,\mathrm{d}x} = G(x) + C.
    \end{align*}
    设 $f$: $I \to J$ 是可导函数. 则 $(g \circ f)\, f^{\prime}$ 也有不定积分
    \begin{align*}
        \int {g(f(t))f^{\prime}(t)\,\mathrm{d}t} = G(f(t)) + C.
    \end{align*}

    一般称这种计算不定积分的方法为 ``第一\emph{换元} (积分) 法''; 不过, 我认为, 可以称其为 ``第一\emph{复合} (积分) 法'', 因为 (表面上) 我代 ``换元'' 以 ``复合''. 事实上, 传统的记号跟我在本书用的新记号表达的仍为同一件事. 所谓 ``第一换元法'' 的本质还是复合与链规则, 只不过, 传统的记号似乎不太允许 ``$x = f(x)$'' 的写法, 故换一个文字是有必要的.
\end{remark}

\begin{example}
    设 $g$ 有不定积分. 设 $a$, $b \in \mathbb{R}$, 且 $a \neq 0$. 则
    \begin{align*}
        \int {g \circ (a\iota + b)}
        = {} & \int {\frac{1}{a}\, (g \circ (a\iota + b))\,\mathrm{D}[a\iota + b]}         \\
        = {} & \int {\Bigg( \frac{g}{a} \circ (a\iota + b) \Bigg)\,\mathrm{D}[a\iota + b]} \\
        = {} & \Bigg( \int {\frac{g}{a}} \Bigg) \circ (a\iota + b)                         \\
        = {} & \Bigg( \frac{1}{a} \int {g} \Bigg) \circ (a\iota + b).
    \end{align*}
\end{example}

\begin{example}
    设 $a$, $b$, $c \in \mathbb{R}$, 且 $a \neq 0$. 则
    \begin{align*}
        \int {\frac{c}{a\iota + b}}
        = {} & \Bigg( \frac{1}{a} \int {\frac{c}{\iota}} \Bigg) \circ (a\iota + b)                       \\
        = {} & \Bigg( \frac{c}{a} \int {\frac{1}{\iota}} + \mathbb{R} \Bigg) \circ (a\iota + b)          \\
        = {} & \Bigg( \frac{c}{a}\,\mathrm{ln} \circ \mathrm{abs} + \mathbb{R} \Bigg) \circ (a\iota + b) \\
        = {} & \frac{c}{a}\, \mathrm{ln} \circ \mathrm{abs} \circ (a\iota + b) + \mathbb{R}.
    \end{align*}
    类似地, 若 $n \neq -1$, 则
    \begin{align*}
        \int {c(a\iota + b)^n}
        = {} & \Bigg( \frac{1}{a} \int {c\iota^n} \Bigg) \circ (a\iota + b)                                \\
        = {} & \Bigg( \frac{c}{a} \int {\iota^n} + \mathbb{R} \Bigg) \circ (a\iota + b)                    \\
        = {} & \Bigg( \frac{c}{a} \cdot \frac{\iota^{n + 1}}{n + 1} + \mathbb{R} \Bigg) \circ (a\iota + b) \\
        = {} & \frac{c(a\iota + b)^{n + 1}}{a(n + 1)} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{remark}
    以后, 若
    \begin{align*}
        k\int {g} = kG + \mathbb{R},
    \end{align*}
    我们可直接写
    \begin{align*}
        \Bigg( k\int {g} \Bigg) \circ f = kG \circ f + \mathbb{R}.
    \end{align*}
\end{remark}

\begin{example}
    利用三角公式, 有
    \begin{align*}
        \int {\mathrm{cos}\,\mathrm{sin}}
        = {} & \int {\frac{1}{2}\, \mathrm{sin} \circ {2\iota}}                           \\
        = {} & \Bigg( \frac{1}{2} \int {\frac{1}{2}\, \mathrm{sin}} \Bigg) \circ {2\iota} \\
        = {} & \Bigg( \frac{1}{4} \int {\mathrm{sin}} \Bigg) \circ {2\iota}               \\
        = {} & {-\frac{1}{4}}\, \mathrm{cos} \circ {2\iota} + \mathbb{R}.
    \end{align*}
    当然, 我们也可以这么解:
    \begin{align*}
        \int {\mathrm{cos}\,\mathrm{sin}}
        = {} & \int {\mathrm{sin}\, \mathrm{D}\,\mathrm{sin}} \\
        = {} & \Bigg( \int {\iota} \Bigg) \circ \mathrm{sin}  \\
        = {} & \frac{1}{2}\, \mathrm{sin}^2 + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    设 $a \in \mathbb{R}$, 且 $a > 0$. 则
    \begin{align*}
        \int {\frac{1}{\sqrt{a^2 - \iota^2}}}
        = {} & \int {\frac{1/a}{\sqrt{1 - (\iota/a)^2}}}                                               \\
        = {} & \Bigg( \frac{1}{1/a} \int {\frac{1/a}{\sqrt{1 - \iota^2}}} \Bigg) \circ \frac{\iota}{a} \\
        = {} & \mathrm{arcsin} \circ \frac{\iota}{a} + \mathbb{R}.
    \end{align*}
    类似地,
    \begin{align*}
        \int {\frac{1}{a^2 + \iota^2}}
        = {} & \int {\frac{1/a^2}{1 + (\iota/a)^2}}                                               \\
        = {} & \Bigg( \frac{1}{1/a} \int {\frac{1/a^2}{1 + \iota^2}} \Bigg) \circ \frac{\iota}{a} \\
        = {} & \frac{1}{a}\,\mathrm{arctan} \circ \frac{\iota}{a} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {\mathrm{tan}}
        = {} & \int {\frac{\mathrm{sin}}{\mathrm{cos}}}                             \\
        = {} & \int {\frac{-\mathrm{D}\,\mathrm{cos}}{\mathrm{cos}}}                \\
        = {} & \Bigg( \int {\frac{-1}{\iota}} \Bigg) \circ \mathrm{cos}             \\
        = {} & {-\,\mathrm{ln}} \circ \mathrm{abs} \circ \mathrm{cos} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {\frac{\mathrm{cos}}{\mathrm{sin}}}
        = {} & \int {\frac{\mathrm{D}\,\mathrm{sin}}{\mathrm{sin}}}            \\
        = {} & \mathrm{ln} \circ \mathrm{abs} \circ \mathrm{sin} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    设 $a \in \mathbb{R}$, 且 $a \neq 0$. 则
    \begin{align*}
        \int {\frac{1}{\iota^2 - a^2}}
        = {} & \int {\frac{1}{(\iota - a)(\iota + a)}}                                \\
        = {} & \int {\frac{(\iota + a) - (\iota - a)}{2a(\iota - a)(\iota + a)}}      \\
        = {} & \int {\Bigg( \frac{1}{2a(\iota - a)} - \frac{1}{2a(\iota + a)} \Bigg)} \\
        = {} & \int {\frac{1}{2a(\iota - a)}} - \int {\frac{1}{2a(\iota + a)}}        \\
        = {} & \Bigg(\int {\frac{1}{2a\iota}}\Bigg) \circ (\iota - a)
        - \Bigg(\int {\frac{1}{2a\iota}}\Bigg) \circ (\iota + a)                      \\
        = {} & \frac{1}{2a}\,\mathrm{ln} \circ \mathrm{abs} \circ (\iota - a)
        - \frac{1}{2a}\,\mathrm{ln} \circ \mathrm{abs} \circ (\iota + a)
        + \mathbb{R}                                                                  \\
        = {} & \frac{1}{2a}\,\mathrm{ln} \Bigg[ \frac{\mathrm{abs} \circ (\iota - a)}
        {\mathrm{abs} \circ (\iota + a)} \Bigg] + \mathbb{R}                          \\
        = {} & \frac{1}{2a}\,\mathrm{ln} \circ \mathrm{abs} \circ
        \frac{\iota - a}{\iota + a} + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {\frac{1}{\mathrm{cos}}}
        = {} & \int {\frac{\mathrm{cos}}{\mathrm{cos}^2}}                               \\
        = {} & \int {\frac{\mathrm{D}\,\mathrm{sin}}{1 - \mathrm{sin}^2}}               \\
        = {} & \Bigg( \int {\frac{1}{1 - \iota^2}} \Bigg) \circ \mathrm{sin}            \\
        = {} & -\frac{1}{2 \cdot 1}\,\mathrm{ln} \circ \mathrm{abs}
        \circ \frac{\iota - 1}{\iota + 1} \circ \mathrm{sin} + \mathbb{R}               \\
        = {} & -\frac{1}{2}\,\mathrm{ln} \circ
        \frac{1 - \mathrm{sin}}{1 + \mathrm{sin}} + \mathbb{R}                          \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{1 + \mathrm{sin}}{1 - \mathrm{sin}}
        + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    \begin{align*}
        \int {\frac{1}{\mathrm{sin}}}
        = {} & \int {\frac{1}{\mathrm{cos} \circ (2\pi/4 - \iota)}}                     \\
        = {} & \Bigg( \frac{1}{-1} \int {\frac{1}{\mathrm{cos}}} \Bigg)
        \circ \bigg( \frac{2\pi}{4} - \iota \bigg)                                      \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ
        \frac{1 - \mathrm{sin}}{1 + \mathrm{sin}} \circ
        \bigg( \frac{2\pi}{4} - \iota \bigg) + \mathbb{R}                               \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{1 - \mathrm{cos}}{1 + \mathrm{cos}}
        + \mathbb{R}.
    \end{align*}
\end{example}

\begin{theorem}
    设 $I$, $J$ 为区间. 设 $g$ 是 $J$ 上的函数. 设 $f$: $I \to J$ 是严单调的可导函数, 且 $\mathrm{D}f$ 不取零值. 若 $(g \circ f)\,\mathrm{D}f$ 有不定积分, \emph{则 $g$ 也有不定积分}, 且
    \begin{align*}
        \int {g} = \Bigg( \int {(g \circ f)\,\mathrm{D}f} \Bigg) \circ f^{[-1]}.
    \end{align*}
\end{theorem}

\begin{proof}
    因为 $f$: $I \to J$ 是严单调的可导函数, 且 $\mathrm{D}f$ 不取零值, 故 $f^{[-1]}$ 也是严单调的可导函数. 设 $G$ 是 $(g \circ f)\,\mathrm{D}f$ 的一个原函数. 则
    \begin{align*}
        \mathrm{D}[G \circ f^{[-1]}]
        = {} & (\mathrm{D}G \circ f^{[-1]})\, \mathrm{D}f^{[-1]}                                                         \\
        = {} & ((g \circ f)\circ f^{[-1]}) \cdot (\mathrm{D}f \circ f^{[-1]}) \cdot \frac{1}{\mathrm{D}f \circ f^{[-1]}} \\
        = {} & (g \circ (f \circ f^{[-1]})) \cdot 1                                                                      \\
        = {} & g \circ \iota = g.
    \end{align*}
    从而
    \begin{align*}
        \int {g}
        = {} & G \circ f^{[-1]} + \mathbb{R}                                          \\
        = {} & (G + \mathbb{R}) \circ f^{[-1]}                                        \\
        = {} & \Bigg( \int {(g \circ f)\,\mathrm{D}f} \Bigg) \circ f^{[-1]}. \qedhere
    \end{align*}
\end{proof}

上述结论有一个变体; 请您仔细比较二者的细微区别.

\begin{theorem}
    设 $I$, $J$ 为区间. \emph{设 $J$ 上的函数 $g$ 有不定积分.} 设 $f$: $I \to J$ 可导. 设 $e$: $J \to I$ 适合 $f \circ e = \iota$. 则
    \begin{align*}
        \int {g} = \Bigg( \int {(g \circ f)\,\mathrm{D}f} \Bigg) \circ e.
    \end{align*}
\end{theorem}

\begin{proof}
    因为 $J$ 上的函数 $g$ 有不定积分, 且 $f$: $I \to J$ 是 $I$ 上的可导函数, 故 $(g \circ f)\, \mathrm{D}f$ 有不定积分, 且
    \begin{align*}
        \Bigg( \int {g} \Bigg) \circ f = \int {(g \circ f)\,\mathrm{D}f}.
    \end{align*}
    从而
    \begin{align*}
        \int {g}
        = {} & \Bigg( \int {g} \Bigg) \circ \{ \iota \}                        \\
        = {} & \Bigg( \int {g} \Bigg) \circ \{ f \circ e \}                    \\
        = {} & \Bigg( \int {g} \Bigg) \circ (\{f\} \circ \{ e \})              \\
        = {} & \Bigg( \Bigg( \int {g} \Bigg) \circ f \Bigg) \circ \{ e \}      \\
        = {} & \Bigg( \int {(g \circ f)\,\mathrm{D}f} \Bigg) \circ e. \qedhere
    \end{align*}
\end{proof}

\begin{example}
    设 $a \in \mathbb{R}$, 且 $a > 0$. 求
    \begin{align*}
        \int {\frac{1}{\sqrt{a^2 + \iota^2}}}.
    \end{align*}

    记 $g = \sqrt{a^2 + \iota^2}$: $\mathbb{R} \to [a, +\infty)$. 不难看出, 求解 $\int {g^{-1}}$ 的最大障碍就是 $\mathrm{sqrt}$ (它一定存在, 因为 $g^{-1}$ 是连续函数). 所以, 我们想一个办法消去根号. 什么东西跟 $g$ 的复合可以不带 $\mathrm{sqrt}$ 呢? 联想到三角恒等式 $1 + \mathrm{tan}^2 = \mathrm{cos}^{-2}$, 故我们可考虑令 $f = a\,\mathrm{tan}$: $(-2\pi/4, 2\pi/4) \to \mathbb{R}$. 则
    \begin{align*}
        (g^{-1} \circ f)\,\mathrm{D}f
        = {} & \frac{a (1 + \mathrm{tan}^2)}{\sqrt{a^2 + a^2 \mathrm{tan}^2}} \\
        = {} & \sqrt{1 + \mathrm{tan}^2}                                      \\
        = {} & \frac{1}{\mathrm{cos}}.
    \end{align*}
    接下来就是要找一个 $e$: $\mathbb{R} \to (-2\pi/4, 2\pi/4)$, 使 $f \circ e = \iota$. 事实上, 这样的 $e$ 并不难找, 因为
    \begin{align*}
        f^{[-1]}
        = {} & (a\iota \circ \mathrm{tan})^{[-1]}        \\
        = {} & \mathrm{tan}^{[-1]} \circ (a\iota)^{[-1]} \\
        = {} & \mathrm{arctan} \circ \frac{\iota}{a},
    \end{align*}
    故我们取 $e$ 为 $f$ 的反函数, 即有 $f \circ e = \iota$. 故
    \begin{align*}
        \int {\frac{1}{\sqrt{a^2 + \iota^2}}}
        = {} & \Bigg( \int {\frac{1}{\mathrm{cos}}} \Bigg) \circ
        \Bigg( \mathrm{arctan} \circ \frac{\iota}{a} \Bigg)                     \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ
        \frac{1 + \mathrm{sin}}{1 - \mathrm{sin}} \circ
        \Bigg( \mathrm{arctan} \circ \frac{\iota}{a} \Bigg) + \mathbb{R}        \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{1 + \iota}{1 - \iota} \circ
        (\mathrm{sin} \circ \mathrm{arctan}) \circ \frac{\iota}{a}
        + \mathbb{R}                                                            \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \Bigg(\frac{1 + \iota}{1 - \iota}
        \circ \frac{\iota}{\sqrt{1 + \iota^2}} \Bigg) \circ \frac{\iota}{a}
        + \mathbb{R}                                                            \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{\sqrt{1 + \iota^2} + \iota}
        {\sqrt{1 + \iota^2} - \iota} \circ \frac{\iota}{a} + \mathbb{R}         \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{\big( \sqrt{1 + \iota^2}
            + \iota \big)^2}
        {\big( \sqrt{1 + \iota^2} - \iota \big)
            \big( \sqrt{1 + \iota^2} + \iota \big)}
        \circ \frac{\iota}{a} + \mathbb{R}                                      \\
        = {} & \bigg( \frac{1}{2}\,\mathrm{ln} \circ \iota^2 \bigg) \circ
        \big( \iota + \sqrt{1 + \iota^2} \big) \circ \frac{\iota}{a}
        + \mathbb{R}                                                            \\
        = {} & \mathrm{ln} \circ \mathrm{abs} \circ
        \big( \iota + \sqrt{1 + \iota^2} \big) \circ \frac{\iota}{a}
        + \mathbb{R}                                                            \\
        = {} & \mathrm{ln} \circ \big( \iota + \sqrt{1 + \iota^2} \big)
        \circ \frac{\iota}{a} + \mathbb{R}                                      \\
        = {} & \mathrm{ln} \circ \Bigg( \frac{\iota + \sqrt{a^2 + \iota^2}}{a}
        \Bigg) + \mathbb{R}                                                     \\
        = {} & \mathrm{ln} \circ \big( \iota + \sqrt{a^2 + \iota^2}
        \big) - \mathrm{ln} [a] + \mathbb{R}                                    \\
        = {} & \mathrm{ln} \circ \big( \iota + \sqrt{a^2 + \iota^2}
        \big) + \mathbb{R}.
    \end{align*}
\end{example}

\begin{example}
    设 $a \in \mathbb{R}$, 且 $a > 0$. 求
    \begin{align*}
        \int {\frac{1}{\sqrt{\iota^2 - a^2}}}.
    \end{align*}

    我们先设 $g = \mathrm{sqrt}^{-1} \circ (\iota^2 - a^2)$: $(a, +\infty) \to (0, +\infty)$. 假如我们算出 $g$ 的不定积分是 $G + \mathbb{R}$, 那么我们可以由此立得 $h = \mathrm{sqrt}^{-1} \circ (\iota^2 - a^2)$: $(-\infty, a) \to (0, +\infty)$ 的不定积分. 这是因为
    \begin{align*}
        h = g \circ (-\iota),
    \end{align*}
    故
    \begin{align*}
        \int {h}
        = {} & \Bigg( \frac{1}{-1} \int {g} \Bigg) \circ (-\iota) \\
        = {} & {-G} \circ (-\iota) + \mathbb{R}.
    \end{align*}

    对于 $g$, 我们考虑 $f = a/\iota$: $(a, +\infty) \to (0, 1)$. 不难看出, $f \circ f = \iota$, 故
    \begin{align*}
        \int {\frac{1}{\sqrt{\iota^2 - a^2}}}
        = {} & \Bigg( \int {\frac{\mathrm{D}f}{\sqrt{f^2 - a^2}}}
        \Bigg) \circ f                                                   \\
        = {} & \Bigg( \int {\frac{-1}{\iota\,\sqrt{1 - \iota^2}}} \Bigg)
        \circ \frac{a}{\iota}.
    \end{align*}

    现在, 我们想办法计算
    \begin{align*}
        \int {\frac{-1}{\iota\,\sqrt{1 - \iota^2}}}.
    \end{align*}
    因为 $\mathrm{sin}$: $(0, 2\pi/4) \to (0, 1)$ 可导, 且 $\mathrm{sin} \circ \mathrm{arcsin} = \iota$, 故
    \begin{align*}
        \int {\frac{-1}{\iota\,\sqrt{1 - \iota^2}}}
        = {} & \Bigg( \int {\frac{-\mathrm{D}\,\mathrm{sin}
        }{\mathrm{sin}\,\mathrm{cos}}} \Bigg) \circ \mathrm{arcsin}              \\
        = {} & \Bigg( \int {\frac{-1}{\mathrm{sin}}} \Bigg)
        \circ \mathrm{arcsin}                                                    \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{1 + \iota}{1 - \iota}
        \circ (\mathrm{cos} \circ \mathrm{arcsin}) + \mathbb{R}                  \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{1 + \iota}{1 - \iota}
        \circ \sqrt{1 - \iota^2} + \mathbb{R}                                    \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{1 + \sqrt{1 - \iota^2}}
        {1 - \sqrt{1 - \iota^2}} + \mathbb{R}                                    \\
        = {} & \frac{1}{2}\,\mathrm{ln} \circ \frac{\big( 1 + \sqrt{1 - \iota^2}
            \big)^2}
        {\big( 1 + \sqrt{1 - \iota^2} \big) \big( 1 - \sqrt{1 - \iota^2} \big)}
        + \mathbb{R}                                                             \\
        = {} & \bigg( \frac{1}{2}\,\mathrm{ln} \circ \iota^2 \bigg)
        \circ \frac{1 + \sqrt{1 - \iota^2}}{\iota} + \mathbb{R}                  \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{1 + \sqrt{1 - \iota^2}}{\iota} + \mathbb{R}.
    \end{align*}
    所以
    \begin{align*}
        \int {\frac{1}{\sqrt{\iota^2 - a^2}}}
        = {} & \Bigg( \int {\frac{-1}{\iota\,\sqrt{1 - \iota^2}}} \Bigg)
        \circ \frac{a}{\iota}                                            \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \Bigg( \frac{1 + \sqrt{1 - \iota^2}}{\iota} \circ \frac{a}{\iota}
        \Bigg) + \mathbb{R}                                              \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{\iota + \sqrt{\iota^2 - a^2}}{a} + \mathbb{R}.
    \end{align*}
    这算出了 $g = \mathrm{sqrt}^{-1} \circ (\iota^2 - a^2)$: $(a, +\infty) \to (0, +\infty)$ 的不定积分. 由此可知 $h = \mathrm{sqrt}^{-1} \circ (\iota^2 - a^2)$: $(-\infty, -a) \to (0, +\infty)$ 的不定积分是
    \begin{align*}
        \int {\frac{1}{\sqrt{\iota^2 - a^2}}}
        = {} & {-\mathrm{ln}} \circ \mathrm{abs}
        \circ \frac{\iota + \sqrt{\iota^2 - a^2}}{a} \circ (-\iota)
        + \mathbb{R}                                          \\
        = {} & {-\mathrm{ln}} \circ \mathrm{abs}
        \circ \frac{-\iota + \sqrt{(-\iota)^2 - a^2}}{a}
        + \mathbb{R}                                          \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{a}{-\iota + \sqrt{\iota^2 - a^2}}
        + \mathbb{R}                                          \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{a \big(\iota + \sqrt{\iota^2 - a^2} \big)}
        {\big(-\iota + \sqrt{\iota^2 - a^2} \big)
        \big(\iota + \sqrt{\iota^2 - a^2} \big)} + \mathbb{R} \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{\iota + \sqrt{\iota^2 - a^2}}{-a}
        + \mathbb{R}                                          \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{\iota + \sqrt{\iota^2 - a^2}}{a}
        + \mathbb{R}.
    \end{align*}

    综上, 若区间 $J$ 不包含 $[-a, a]$, 则
    \begin{align*}
        \int {\frac{1}{\sqrt{\iota^2 - a^2}}}
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \frac{\iota + \sqrt{\iota^2 - a^2}}{a}
        + \mathbb{R}                          \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \big( \iota + \sqrt{\iota^2 - a^2} \big)
        - \mathrm{ln}[|a|] + \mathbb{R}       \\
        = {} & \mathrm{ln} \circ \mathrm{abs}
        \circ \big( \iota + \sqrt{\iota^2 - a^2} \big)
        + \mathbb{R}.
    \end{align*}
\end{example}

\begin{remark}
    设 $a \in \mathbb{R}$, 且 $a > 0$. 则
    \begin{align*}
        \int {\frac{1}{\sqrt{\iota^2 \pm a^2}}} = \mathrm{ln} \circ \mathrm{abs} \circ \big( \iota + \sqrt{\iota^2 \pm a^2} \big) + \mathbb{R}.
    \end{align*}
\end{remark}

我再介绍一个解不定积分的法则.

\begin{theorem}
    设 $I$ 为区间, $f$, $g$ 都是 $I$ 上的可导函数. 若 $g\mathrm{D}f$ 有不定积分, 则 $f\mathrm{D}g$ 也有不定积分, 且
    \begin{align*}
        \int {f\mathrm{D}g} = fg - \int {g\mathrm{D}f}.
    \end{align*}
\end{theorem}

\begin{proof}
    设 $H$ 是 $g\mathrm{D}f$ 的一个原函数. 则
    \begin{align*}
        \mathrm{D}[fg - H]
        = {} & \mathrm{D}f \cdot g + f \cdot \mathrm{D}g - \mathrm{D}H \\
        = {} & g\mathrm{D}f + f\mathrm{D}g - g\mathrm{D}f              \\
        = {} & f\mathrm{D}g.
    \end{align*}
    从而
    \begin{align*}
        \int {f\mathrm{D}g}
        = {} & (fg - H) + \mathbb{R}              \\
        = {} & fg - (H + \mathbb{R})              \\
        = {} & fg - \int {g\mathrm{D}f}. \qedhere
    \end{align*}
\end{proof}

\begin{example}
    设整数 $m \neq 0$. 则
    \begin{align*}
        \int {\iota^{m - 1} \, \mathrm{ln}}
        = {} & \int {\mathrm{ln}\, \mathrm{D}\,\frac{\iota^{m}}{m}} \\
        = {} & \mathrm{ln}\, \frac{\iota^{m}}{m}
        - \int {\frac{\iota^{m}}{m}\,\mathrm{D}\,\mathrm{ln}}       \\
        = {} & \frac{\iota^{m}\,\mathrm{ln}}{m}
        - \int {\frac{\iota^{m - 1}}{m}}                            \\
        = {} & \frac{\iota^{m}}{m^2}
        (m\,\mathrm{ln} - 1) + \mathbb{R}.
    \end{align*}
\end{example}

\begin{remark}
    \begin{align*}
        \int {\frac{\mathrm{ln}}{\iota}}
        = {} & \int {\mathrm{ln}\,\mathrm{D}\,\mathrm{ln}}  \\
        = {} & \Bigg( \int {\iota} \Bigg) \circ \mathrm{ln} \\
        = {} & \frac{1}{2}\, \mathrm{ln}^2 + \mathbb{R}.
    \end{align*}
\end{remark}

\begin{example}
    设 $I$, $J$ 为区间. 设 $f$: $I \to J$ 是严单调的可导函数, 且 $\mathrm{D}f$ 不取零值. 所以, $f^{[-1]}$ 也是严单调的可导函数. 从而
    \begin{align*}
        \int {f^{[-1]}}
        = {} & \int {f^{[-1]}\, \mathrm{D}\,\iota}                            \\
        = {} & f^{[-1]}\,\iota - \int {\iota\,\mathrm{D}f^{[-1]}}             \\
        = {} & \iota f^{[-1]} - \int {(f \circ f^{[-1]})\,\mathrm{D}f^{[-1]}} \\
        = {} & \iota f^{[-1]} - \Bigg( \int {f} \Bigg) \circ f^{[-1]}.
    \end{align*}
\end{example}

\begin{example}
    我们可轻松地求解 $\mathrm{arcsin}$ 的不定积分:
    \begin{align*}
        \int {\mathrm{arcsin}}
        = {} & \iota\, \mathrm{arcsin} - \Bigg( \int {\mathrm{sin}} \Bigg) \circ \mathrm{arcsin} \\
        = {} & \iota\, \mathrm{arcsin} + \mathrm{cos} \circ \mathrm{arcsin} + \mathbb{R}         \\
        = {} & \iota\, \mathrm{arcsin} + \mathrm{sqrt} \circ (1 - \iota^2) + \mathbb{R}.
    \end{align*}
    类似地,
    \begin{align*}
        \int {\mathrm{arctan}}
        = {} & \iota\, \mathrm{arctan} - \Bigg( \int {\mathrm{tan}} \Bigg) \circ \mathrm{arctan}                                  \\
        = {} & \iota\, \mathrm{arctan} - \mathrm{ln} \circ \mathrm{abs} \circ \mathrm{cos} \circ \mathrm{arctan} + \mathbb{R}     \\
        = {} & \iota\, \mathrm{arctan} + \mathrm{ln} \circ \mathrm{abs} \circ \mathrm{sqrt}^{-1} \circ (1 + \iota^2) + \mathbb{R} \\
        = {} & \iota\, \mathrm{arctan} + \mathrm{ln} \circ \mathrm{sqrt}^{-1} \circ (1 + \iota^2) + \mathbb{R}                    \\
        = {} & \iota\, \mathrm{arctan} - \mathrm{ln} \circ \mathrm{sqrt} \circ (1 + \iota^2) + \mathbb{R}                         \\
        = {} & \iota\, \mathrm{arctan} - \frac{1}{2}\,\mathrm{ln} \circ (1 + \iota^2) + \mathbb{R}.
    \end{align*}
\end{example}

原则上, 我还可以再举一些例; 不过, 我感觉, 学而不思则罔, 思而不学则殆. 再者, 我假定您学过微积分, 所以您可以自行找高等算学 (或算学分析) 教材上的问题练习. 当然, 请试用我在本书讲的 ``无变量不定积分法''.
